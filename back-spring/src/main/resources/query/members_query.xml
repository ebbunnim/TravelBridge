<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.pjt1.demo.model.dao.MembersDao" >
    <insert id="insert"		parameterType="members">
		INSERT INTO members
		(mem_id, mem_email, 
		mem_phone, 
		mem_name, mem_sex,
		mem_birth, mem_address, 
		mem_grant,
		mem_interest, mem_token, mem_login_type) 
		VALUES (
		#{mem_id:VARCHAR}, #{mem_email:VARCHAR}, 
		#{mem_phone:VARCHAR}, 
		#{mem_name:VARCHAR},#{mem_sex:INTEGER}, 
		#{mem_birth:VARCHAR}, #{mem_address:VARCHAR}, 
		#{mem_grant:INTEGER}, 
		#{mem_interest:VARCHAR}, #{mem_token:VARCHAR}, #{mem_login_type:VARCHAR}
		)
	</insert> 
   	<delete id="delete" 	parameterType="int">
	   UPDATE MEMBERS
	   SET 
	   mem_regtime = CURRENT_TIMESTAMP(), 
	   mem_del_check = true
	   WHERE mem_no = #{mem_no} AND mem_del_check = false
	</delete>
   	<update id="update"		parameterType="members">
		UPDATE members SET
		mem_id=#{mem_id:VARCHAR}, mem_email=#{mem_email:VARCHAR}, 
		mem_phone=#{mem_phone:VARCHAR},
		mem_name=#{mem_name:VARCHAR}, mem_sex=#{mem_sex:INTEGER}, 
		mem_birth=#{mem_birth:VARCHAR}, mem_address=#{mem_address:VARCHAR}, 
		mem_grant= #{mem_grant:INTEGER}, mem_receive_email=#{mem_receive_email:BOOLEAN}, 
		mem_following=#{mem_following:INTEGER}, mem_followed=#{mem_followed:INTEGER},
		mem_lastlogin=CURRENT_TIMESTAMP(), mem_interest=#{mem_interest:VARCHAR}, 
		mem_token=#{mem_token:VARCHAR}, mem_login_type=#{mem_login_type:VARCHAR},
		mem_del_check=#{mem_del_check:BOOLEAN}
		WHERE mem_no = #{mem_no}
	</update>
   	<select id="search"		parameterType="int" resultType="members">
		SELECT * 
		FROM members 
		WHERE mem_no=#{mem_no:INTEGER} 
		AND mem_del_check=false   
	</select>
   	<select id="searchAll"	resultType="members">
		SELECT * 
		FROM members 
		WHERE mem_del_check = false
	</select> 

	<select id="searchMemberByEmail" parameterType="String" resultType="Members">
		SELECT * FROM members WHERE mem_email=#{mem_email:VARCHAR} and mem_del_check=false
	</select>
	<resultMap type="post" id="postMap">
		<result property="post_title" column="post_title"/>
		<result property="post_category" column="post_category"/>
		<result property="post_regtime" column="post_regtime"/>
		<result property="post_city" column="post_city"/>
		<result property="post_hits" column="post_hits"/>
	</resultMap>
	
	<resultMap id="likePostMap" type="Members">
		<id property="mem_id" column="mem_id"/>
		<collection property="mem_likePost" ofType="Post" resultMap="postMap"/>
	</resultMap>
	
	<select id="searchMemberLikePost" parameterType="int" resultMap="likePostMap">
		SELECT 
		m.mem_id, 
		l.like_no, 
		l.post_no, 
		p.post_title, 
		p.post_category, 
		p.post_regtime, 
		p.post_city, 
		p.post_hits
		FROM members m
		LEFT JOIN likes l ON m.mem_no = l.liker_mem_no AND l.like_del_check=FALSE
		LEFT JOIN post p ON l.post_no = p.post_no AND p.post_del_check=FALSE
		WHERE m.mem_no = #{mem_no} AND m.mem_del_check = FALSE; 
	</select>

</mapper>

